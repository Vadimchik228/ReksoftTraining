-- Создание GIST-индексов

CREATE EXTENSION btree_gist;

-- students
CREATE INDEX idx_students_first_name_gist ON students USING GIST (first_name gist_trgm_ops);
CREATE INDEX idx_students_last_name_gist ON students USING GIST (last_name gist_trgm_ops);
CREATE INDEX idx_students_phone_number_gist ON students USING GIST (phone_number gist_trgm_ops);
ANALYSE students;

-- subjects
CREATE INDEX idx_subjects_name_gist ON subjects USING GIST (name gist_trgm_ops);
ANALYSE subjects;

-- specializations
CREATE INDEX idx_specializations_specialty_code_gist ON specializations USING GIST (specialty_code gist_trgm_ops);
CREATE INDEX idx_specializations_full_name_gist ON specializations USING GIST (full_name gist_trgm_ops);
ANALYSE specializations;

-- faculties
CREATE INDEX idx_faculties_name_gist ON faculties USING GIST (name gist_trgm_ops);
ANALYSE faculties;

-- Проверка размеров индексов

-- students
SELECT pg_relation_size('idx_students_first_name_gist');
SELECT pg_relation_size('idx_students_last_name_gist');
SELECT pg_relation_size('idx_students_phone_number_gist');

-- subjects
SELECT pg_relation_size('idx_subjects_name_gist');

-- specializations
SELECT pg_relation_size('idx_specializations_specialty_code_gist');
SELECT pg_relation_size('idx_specializations_full_name_gist');

-- faculties
SELECT pg_relation_size('idx_faculties_name_gist');

-- Удаление индексов

-- students
DROP INDEX IF EXISTS idx_students_first_name_gist;
DROP INDEX IF EXISTS idx_students_last_name_gist;
DROP INDEX IF EXISTS idx_students_phone_number_gist;

-- subjects
DROP INDEX IF EXISTS idx_subjects_name_gist;

-- specializations
DROP INDEX IF EXISTS idx_specializations_specialty_code_gist;
DROP INDEX IF EXISTS idx_specializations_full_name_gist;

-- faculties
DROP INDEX IF EXISTS idx_faculties_name_gist;